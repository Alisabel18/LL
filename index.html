<!DOCTYPE html>
<html>
<head>
  <title>Participant Level Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select { padding: 8px; width: 100%; margin-bottom: 10px; }
    button { padding: 10px 15px; margin-top: 10px; }
    #dashboard { margin-top: 30px; border-top: 2px solid #ccc; padding-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>

<h2>Participant Entry</h2>
<form id="participantForm">
  <label>Name</label>
  <input type="text" id="name" required pattern="[A-Z][a-z]*( [A-Z][a-z]*)*" title="First letter of each name must be capitalized">

  <label>Birthdate</label>
  <input type="date" id="birthdate" required>

  <label>Age</label>
  <input type="number" id="age" readonly>

  <label>Gender</label>
  <select id="gender">
    <option value="">Select Gender</option>
    <option>Male</option>
    <option>Female</option>
    <option>Other</option>
  </select>

  <label>Civil Status</label>
  <select id="civilStatus">
    <option value="">Select Status</option>
    <option>Single</option>
    <option>Married</option>
    <option>Widowed</option>
  </select>

  <label>Cluster</label>
  <select id="cluster">
    <option value="">Select Cluster</option>
    <option>Luzon</option>
    <option>Visayas</option>
    <option>Mindanao</option>
  </select>

  <label>Location</label>
  <select id="location">
    <option value="">Select Location</option>
    <!-- Add options here later -->
    <option>Sample Location 1</option>
    <option>Sample Location 2</option>
  </select>

  <label>Confidence Questions (1-5)</label>
  <div id="confidenceInputs"></div>

  <label>Trainings Attended</label>
  <input type="checkbox" value="OVP" class="training"> OVP
  <input type="checkbox" value="OPP" class="training"> OPP
  <input type="checkbox" value="OFP" class="training"> OFP

  <label>Expected Harvest (kg)</label>
  <input type="number" id="expectedHarvest" min="0" max="1000">

  <label>Actual Harvest (kg)</label>
  <input type="number" id="actualHarvest" min="0" max="1000">

  <label>Harvest for Consumption (kg)</label>
  <input type="number" id="consumedKg" min="0" max="1000">

  <label>Income from Selling (₱)</label>
  <input type="number" id="income" min="0">

  <button type="button" onclick="submitForm()">Submit</button>
</form>

<div id="dashboard">
  <h3>Dashboard</h3>
  <table id="participantTable">
    <thead>
      <tr>
        <th>Name</th><th>Age</th><th>Cluster</th><th>Confidence Mean</th><th>Harvest Reached 75%</th><th>Trainings Attended</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const adminPassword = "admin123"; // change to secure password
const confidenceInputs = document.getElementById('confidenceInputs');

for (let i = 1; i <= 5; i++) {
  const select = document.createElement('select');
  select.innerHTML = `<option value="">Q${i}</option>` +
    [1,2,3,4,5].map(n => `<option value="${n}">${n}</option>`).join('');
  confidenceInputs.appendChild(select);
}

document.getElementById('birthdate').addEventListener('change', () => {
  const birthDate = new Date(document.getElementById('birthdate').value);
  const age = new Date().getFullYear() - birthDate.getFullYear();
  document.getElementById('age').value = age;
});

function submitForm() {
  const name = document.getElementById('name').value.trim();
  if (!/^[A-Z][a-z]*( [A-Z][a-z]*)*$/.test(name)) {
    alert("Name must be capitalized (e.g. Juan Dela Cruz)");
    return;
  }

  const age = document.getElementById('age').value;
  const cluster = document.getElementById('cluster').value;
  const confidenceValues = Array.from(confidenceInputs.querySelectorAll('select'))
    .map(select => parseFloat(select.value)).filter(v => !isNaN(v));
  const confidenceMean = confidenceValues.length ? (confidenceValues.reduce((a, b) => a + b, 0) / confidenceValues.length).toFixed(2) : '—';

  const expected = parseFloat(document.getElementById('expectedHarvest').value);
  const actual = parseFloat(document.getElementById('actualHarvest').value);
  const harvestStatus = (actual >= 0.75 * expected) ? 'Yes' : 'No';

  const trainings = Array.from(document.querySelectorAll('.training:checked')).length;

  const tbody = document.getElementById('participantTable').querySelector('tbody');
  const row = tbody.insertRow();
  row.insertCell(0).innerText = name;
  row.insertCell(1).innerText = age;
  row.insertCell(2).innerText = cluster;
  row.insertCell(3).innerText = confidenceMean;
  row.insertCell(4).innerText = harvestStatus;
  row.insertCell(5).innerText = trainings;
  const deleteCell = row.insertCell(6);
  const btn = document.createElement('button');
  btn.innerText = "Delete";
  btn.onclick = () => {
    const pwd = prompt("Enter admin password to delete:");
    if (pwd === adminPassword) row.remove();
    else alert("Incorrect password.");
  };
  deleteCell.appendChild(btn);

  document.getElementById('participantForm').reset();
  confidenceInputs.innerHTML = "";
  for (let i = 1; i <= 5; i++) {
    const select = document.createElement('select');
    select.innerHTML = `<option value="">Q${i}</option>` +
      [1,2,3,4,5].map(n => `<option value="${n}">${n}</option>`).join('');
    confidenceInputs.appendChild(select);
  }
}
</script>
</body>
</html>
